
# 微服务 CAP 理论

CAP原则又称CAP定理，指的是在一个分布式系统中：

- 一致性(Consistency) (所有节点在同一时间具有相同的数据)
- 可用性(Availability) (保证每个请求不管成功或者失败都有响应)
- 分隔容忍(Partition tolerance) (系统中任意信息的丢失或失败不会影响系统的继续运作)


CAP 原则指的是，这三个要素最多只能同时实现两点，不可能三者兼顾。

> 关于一致性的理解，我觉得是在整个系统中某个部分，挂掉了，或者宕机了，并不影响整个系统的运作或者说使用
> 而可用性是，某个系统的某个节点挂了，但是并不影响系统的接受或者发出请求
 
CAP 不可能都取，只能取其中2个原因是 ：
- 如果C是第一需求的话，那么会影响A的性能，因为要数据同步，不然请求结果会有差异，但是数据同步会消耗时间，期间可用性就会降低。
- 如果A是第一需求，那么只要有一个服务在，就能正常接受请求，但是对与返回结果变不能保证，原因是，在分布式部署的时候，数据一致的过程不可能想切线路那么快。
- 再如果，同事满足一致性和可用性，那么分区容错就很难保证了，也就是单点，也是分布式的基本核心，好了，明白这些理论，就可以在相应的场景选取服务注册与发现了

## 注册服务发现对比

|Nacos | Eureka | Consul | CoreDNS | Zookeeper|
| :---: | :---: | :---: | :---: | :---: |
|一致性协议 | CP+AP | AP | CP | 无 | CP |
|健康检查 | TCP HTTP MYSQL Client Beat | Client Beat | TCP HTTP gRPC Cmd | 无  | Keep Alive |
|负载均衡策略 | 权重 metadata Selector | Ribbon | Fabio | RoundRobin | 无 |
|雪崩保护 | 有 | 有 | 无 | 无 | 无 |
|自动注销实例 | 支持 | 支持 | 支持 | 不支持 | 支持 |
|访问协议 | HTTP/DNS | HTTP | HTTP/DNS | DNS | TCP |
|监听支持 | 支持 | 支持 | 支持 | 不支持 | 支持 |
|多数据中心 | 支持 | 支持 | 支持 | 不支持 | 不支持 |
|跨注册中心同步 | 支持 | 不支持 | 支持 | 不支持 | 不支持 |
|SpringCloud集成 | 支持 | 支持 | 支持 | 不支持 | 支持 |
|Dubbo集成 | 支持 | 不支持 | 支持 | 不支持 | 支持 |
|K8S集成 | 支持 | 不支持 | 支持 | 支持 | 不支持 |